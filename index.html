<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elif için 🌹</title>
  <style>
    body {margin:0;font-family:Georgia,serif;background:#0d0d0d;color:#f2f2f2;text-align:center}
    header{padding:20px;border-bottom:1px solid #222}
    .chat{margin:20px auto;max-width:700px;background:#141214;padding:16px;border-radius:10px;box-shadow:0 0 18px #330033;display:none}
    #chat-box{height:360px;overflow-y:auto;background:#0b0b0b;padding:12px;border-radius:6px;text-align:left}
    .bot-message{background:#3a003a;color:#fff;padding:10px;margin:8px 0;border-radius:10px;max-width:80%}
    .user-message{background:#552255;color:#fff;padding:10px;margin:8px 0;border-radius:10px;max-width:80%;margin-left:auto}
    #controls{display:flex;gap:8px;margin-top:12px;justify-content:center}
    #user-input{flex:1;padding:10px;border-radius:6px;border:none;outline:none;min-width:0}
    #send-btn{padding:10px 16px;border-radius:6px;border:none;background:#660066;color:#fff;cursor:pointer}
    #send-btn:active{transform:translateY(1px)}
    footer{padding:14px;color:#999}
    #start-btn{margin-top:50px;padding:18px 32px;font-size:18px;border:none;border-radius:10px;background:#660066;color:#fff;cursor:pointer;box-shadow:0 0 15px #330033}
    #start-btn:hover{background:#880088}
  </style>
</head>
<body>
  <header>
    <h1>Elif, Bende Yerin Bir Başka 💜</h1>
    <p>Karanlık bile olsa ışığım sensin.</p>
  </header>

  <!-- Başlat butonu -->
  <button id="start-btn">🌹 Başlat 🌹</button>

  <!-- Sohbet kutusu -->
  <section class="chat" id="chat-section">
    <div id="chat-box">
      <div class="bot-message">Merhaba Elif 💜 Nasılsın bugün?</div>
    </div>
    <div id="controls">
      <input id="user-input" type="text" placeholder="Mesajını yaz Elif..." autocomplete="off" />
      <button id="send-btn">Gönder</button>
    </div>
  </section>

  <!-- Müzik -->
  <audio id="bg-music" loop>
    <source src="plot-twins.mp3" type="audio/mpeg">
  </audio>

  <footer>
    <p>© 2025 Senin için, Fensy</p>
  </footer>

  <script>
    const chatSection = document.getElementById("chat-section");
    const chatBox = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const startBtn = document.getElementById("start-btn");
    const music = document.getElementById("bg-music");

    function addMessage(text, sender){
      const d = document.createElement("div");
      d.className = sender === "user" ? "user-message" : "bot-message";
      d.innerText = text;
      chatBox.appendChild(d);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Backend'e istek atan fonksiyon
    async function botReply(userText){
      try {
        const res = await fetch("https://bot-backend-moqd.onrender.com/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userText })
        });

        if(!res.ok) throw new Error("Sunucu hatası: " + res.status);
        const data = await res.json();

        // backend'in cevabını çözümle
        if(data.reply) return data.reply;
        if(data.choices && data.choices[0]?.message?.content) return data.choices[0].message.content;
        return "Sana yanıt veremedim ama kalbim hep seninle 💜";
      } catch (err) {
        console.error(err);
        return "⚠️ Şu an yanıt veremiyorum, birazdan tekrar dene Elif 🌹";
      }
    }

    async function handleSend(){
      const txt = userInput.value.trim();
      if(!txt) return;
      addMessage(txt, "user");
      userInput.value = "";

      const reply = await botReply(txt);
      setTimeout(()=> addMessage(reply, "bot"), 600);
    }

    sendBtn.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", e => { if(e.key==="Enter") handleSend(); });

    // Başlat butonu → sohbeti aç + müzik başlat
    startBtn.addEventListener("click", () => {
      startBtn.style.display = "none";
      chatSection.style.display = "block";
      music.play().then(()=>{ music.volume = 0.5; }).catch(()=>{});
    });
  </script>
</body>
</html>
